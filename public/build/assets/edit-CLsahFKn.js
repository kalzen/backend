import{m as M,r as p,j as e,L as T,$ as E}from"./app-DUoLdvnI.js";import{A as L,D as B,a as H,b as I,k as $,l as z,m as A}from"./app-layout-CyD3s8AU.js";import{H as P}from"./heading-small-B2tI4bcv.js";import{B as x}from"./app-logo-icon-B8ijC97A.js";import{I as b}from"./input-Cww9B_pM.js";import{L as d}from"./label-CZGqZ-P5.js";import{I as m}from"./input-error-BwbzyMER.js";import{C as U}from"./checkbox-BkdHdfP5.js";import{I as R}from"./image-uploader-4xJW3Fcg.js";import{B as V}from"./badge-DCwR_g65.js";import{T as C}from"./tag-Bu320YOe.js";import{C as X}from"./chevron-down-DbXJJz_j.js";import{z as q}from"./transition-brmHZfHb.js";import"./index-DIzOG9aE.js";import"./index-D05ax1I2.js";import"./index-DPXrIM8z.js";import"./card-DloEZqPS.js";import"./helpers-DTePWeAw.js";import"./PencilIcon-ljq4KGqE.js";function me({post:i,categories:l=[]}){const w=[{title:"Bài viết",href:route("posts.index")},{title:i.title,href:route("posts.edit",i.id)}],{data:t,setData:a,post:y,processing:f,errors:n,recentlySuccessful:_,clearErrors:D}=M({title:i.title,content:i.content,description:i.description,slug:i.slug,image:null,is_published:i.is_published,published_at:i.published_at||"",categories:i.categories||[],_method:"PUT"}),k=s=>{s.preventDefault(),t.slug===i.slug&&D("slug"),y(route("posts.update",i.id),{forceFormData:!0})},S=()=>{t.title&&t.title!==i.title&&t.slug===i.slug&&a("slug",t.title.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,""))};p.useEffect(()=>{S()},[t.title]),i.categories.map(s=>s.toString()),l.map(s=>({label:s.name,value:s.id.toString(),icon:C}));const[h,j]=p.useState([]);p.useEffect(()=>{const s=i.categories.map(r=>{const c=l.find(u=>u.id===r);return c?c.name:""}).filter(r=>r!=="");j(s)},[i.categories,l]);const F=(s,r)=>{var v,N;let c,u;if(r){c=[...t.categories,s];const g=((v=l.find(o=>o.id===s))==null?void 0:v.name)||"";u=[...h,g]}else{c=t.categories.filter(o=>o!==s);const g=((N=l.find(o=>o.id===s))==null?void 0:N.name)||"";u=h.filter(o=>o!==g)}a("categories",c),j(u)};return e.jsxs(L,{breadcrumbs:w,children:[e.jsx(T,{title:`Sửa bài viết: ${i.title}`}),e.jsxs("div",{className:"space-6 px-4 py-6",children:[e.jsx("div",{className:"pb-4",children:e.jsx(P,{title:`Sửa bài viết: ${i.title}`,description:"Chỉnh sửa nội dung và thông tin bài viết"})}),e.jsxs("form",{onSubmit:k,className:"space-y-6 pt-4 border-t",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"title",children:"Tiêu đề"}),e.jsx(b,{id:"title",value:t.title,onChange:s=>a("title",s.target.value),placeholder:"Tiêu đề bài viết"}),e.jsx(m,{message:n.title})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"slug",children:"Đường dẫn"}),e.jsx(b,{id:"slug",value:t.slug,onChange:s=>a("slug",s.target.value),placeholder:"duong-dan-bai-viet"}),e.jsx(m,{message:n.slug})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"description",children:"Mô tả"}),e.jsx("textarea",{id:"description",className:"min-h-[120px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:t.description,onChange:s=>a("description",s.target.value),placeholder:"Mô tả ngắn gọn về bài viết của bạn",rows:3}),e.jsx(m,{message:n.description})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"content",children:"Nội dung"}),e.jsx("textarea",{id:"content",className:"min-h-[200px] rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:t.content,onChange:s=>a("content",s.target.value),placeholder:"Viết nội dung bài viết của bạn tại đây",rows:8}),e.jsx(m,{message:n.content})]}),l.length>0&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"categories",children:"Danh mục"}),e.jsxs(B,{children:[e.jsx(H,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-between",children:[e.jsx("span",{className:"flex flex-wrap gap-1",children:h.length>0?h.map((s,r)=>e.jsx(V,{variant:"secondary",className:"mr-1",children:s},r)):e.jsx("span",{className:"text-muted-foreground",children:"Chọn danh mục cho bài viết"})}),e.jsx(X,{className:"h-4 w-4 opacity-50"})]})}),e.jsxs(I,{align:"start",className:"w-56 max-h-80 overflow-auto",children:[e.jsx($,{children:"Danh mục"}),e.jsx(z,{}),l.map(s=>e.jsx(A,{checked:t.categories.includes(s.id),onCheckedChange:r=>F(s.id,r),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-2 text-muted-foreground"}),s.name]})},s.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Bạn có thể chọn nhiều danh mục cho bài viết"}),n.categories&&e.jsx("p",{className:"text-sm text-red-600",children:n.categories})]}),e.jsx("div",{className:"grid gap-2",children:e.jsx(R,{id:"image",value:i.featured_image,onChange:s=>a("image",s),title:"Hình ảnh đại diện",description:"Cập nhật hình ảnh đại diện",error:n.image,helpText:"Để trống nếu không muốn thay đổi hình ảnh. Hệ thống sẽ tự động tối ưu hình ảnh mới.",placeholderImage:"/assets/image-placeholder.png",className:"w-24 h-24 rounded-md",previewClassName:"w-full h-48"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{id:"is_published",checked:t.is_published,onCheckedChange:s=>a("is_published",s)}),e.jsx(d,{htmlFor:"is_published",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Xuất bản ngay"}),e.jsx(m,{message:n.is_published})]}),!t.is_published&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(d,{htmlFor:"published_at",children:"Ngày xuất bản"}),e.jsx(b,{id:"published_at",type:"datetime-local",value:t.published_at,onChange:s=>a("published_at",s.target.value)}),e.jsx(m,{message:n.published_at})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{type:"submit",disabled:f,children:f?"Đang cập nhật...":"Cập nhật bài viết"}),e.jsx(E,{href:route("posts.index"),children:e.jsx(x,{variant:"outline",type:"button",children:"Hủy"})}),e.jsx(q,{show:_,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-neutral-600",children:"Đã lưu"})})]})]})]})]})}export{me as default};
